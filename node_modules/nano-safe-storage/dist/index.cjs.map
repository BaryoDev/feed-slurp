{"version":3,"sources":["../src/index.ts"],"sourcesContent":["export interface StorageOptions {\n    /** Key prefix for namespacing (default: '') */\n    prefix?: string;\n    /** Default TTL in seconds (optional) */\n    ttl?: number;\n}\n\nexport interface SetOptions {\n    /** TTL for this specific item in seconds */\n    ttl?: number;\n}\n\ninterface StoredValue<T> {\n    value: T;\n    expiry?: number;\n}\n\n// In-memory fallback store\nconst memoryStore: Record<string, string> = {};\n\nconst memoryFallback = {\n    getItem: (key: string): string | null => memoryStore[key] ?? null,\n    setItem: (key: string, value: string): void => {\n        memoryStore[key] = value;\n    },\n    removeItem: (key: string): void => {\n        delete memoryStore[key];\n    },\n    clear: (): void => {\n        for (const key in memoryStore) delete memoryStore[key];\n    }\n};\n\n// Detect available storage\nfunction getStorage(): Storage | typeof memoryFallback {\n    try {\n        if (typeof window !== 'undefined' && window.localStorage) {\n            const testKey = '__nano_safe_test__';\n            window.localStorage.setItem(testKey, testKey);\n            window.localStorage.removeItem(testKey);\n            return window.localStorage;\n        }\n    } catch {\n        // localStorage unavailable (Safari Private Mode, etc.)\n    }\n    return memoryFallback;\n}\n\nconst storage = getStorage();\n\n/**\n * Creates a namespaced storage instance with optional TTL support.\n */\nexport function createStorage(options: StorageOptions = {}) {\n    const { prefix = '', ttl: defaultTtl } = options;\n\n    const prefixKey = (key: string) => `${prefix}${key}`;\n\n    return {\n        /**\n         * Sets a value in storage with optional TTL.\n         */\n        set<T>(key: string, value: T, setOptions?: SetOptions): void {\n            try {\n                const ttl = setOptions?.ttl ?? defaultTtl;\n                const stored: StoredValue<T> = {\n                    value,\n                    expiry: ttl ? Date.now() + ttl * 1000 : undefined\n                };\n                storage.setItem(prefixKey(key), JSON.stringify(stored));\n            } catch (err) {\n                console.warn(`nano-safe-storage: set failed for key \"${key}\"`, err);\n            }\n        },\n\n        /**\n         * Gets a value from storage. Returns null if expired or not found.\n         */\n        get<T>(key: string): T | null {\n            try {\n                const raw = storage.getItem(prefixKey(key));\n                if (raw === null) return null;\n\n                const stored: StoredValue<T> = JSON.parse(raw);\n\n                // Check expiry\n                if (stored.expiry && Date.now() > stored.expiry) {\n                    this.remove(key);\n                    return null;\n                }\n\n                return stored.value;\n            } catch {\n                return null;\n            }\n        },\n\n        /**\n         * Removes an item from storage.\n         */\n        remove(key: string): void {\n            try {\n                storage.removeItem(prefixKey(key));\n            } catch (err) {\n                console.warn(`nano-safe-storage: remove failed for key \"${key}\"`, err);\n            }\n        },\n\n        /**\n         * Checks if a key exists and is not expired.\n         */\n        has(key: string): boolean {\n            return this.get(key) !== null;\n        },\n\n        /**\n         * Clears all items with the current prefix.\n         */\n        clear(): void {\n            try {\n                if (prefix && typeof window !== 'undefined' && window.localStorage) {\n                    const keys = Object.keys(localStorage).filter(k => k.startsWith(prefix));\n                    keys.forEach(k => localStorage.removeItem(k));\n                } else {\n                    storage.clear();\n                }\n            } catch (err) {\n                console.warn('nano-safe-storage: clear failed', err);\n            }\n        },\n\n        /**\n         * Checks if storage is available (not using memory fallback).\n         */\n        isAvailable(): boolean {\n            return storage !== memoryFallback;\n        }\n    };\n}\n\n// Default instance without prefix\nconst defaultStorage = createStorage();\n\nexport const { set: setItem, get: getItem, remove: removeItem, has, clear } = {\n    set: defaultStorage.set.bind(defaultStorage),\n    get: defaultStorage.get.bind(defaultStorage),\n    remove: defaultStorage.remove.bind(defaultStorage),\n    has: defaultStorage.has.bind(defaultStorage),\n    clear: defaultStorage.clear.bind(defaultStorage)\n};\n\nexport default createStorage;\n"],"mappings":"yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,WAAAE,EAAA,kBAAAC,EAAA,YAAAC,EAAA,YAAAC,EAAA,QAAAC,EAAA,eAAAC,EAAA,YAAAC,IAAA,eAAAC,EAAAT,GAkBA,IAAMU,EAAsC,CAAC,EAEvCC,EAAiB,CACnB,QAAUC,GAA+BF,EAAYE,CAAG,GAAK,KAC7D,QAAS,CAACA,EAAaC,IAAwB,CAC3CH,EAAYE,CAAG,EAAIC,CACvB,EACA,WAAaD,GAAsB,CAC/B,OAAOF,EAAYE,CAAG,CAC1B,EACA,MAAO,IAAY,CACf,QAAWA,KAAOF,EAAa,OAAOA,EAAYE,CAAG,CACzD,CACJ,EAGA,SAASE,GAA8C,CACnD,GAAI,CACA,GAAI,OAAO,OAAW,KAAe,OAAO,aAAc,CACtD,IAAMC,EAAU,qBAChB,cAAO,aAAa,QAAQA,EAASA,CAAO,EAC5C,OAAO,aAAa,WAAWA,CAAO,EAC/B,OAAO,YAClB,CACJ,MAAQ,CAER,CACA,OAAOJ,CACX,CAEA,IAAMK,EAAUF,EAAW,EAKpB,SAASX,EAAcc,EAA0B,CAAC,EAAG,CACxD,GAAM,CAAE,OAAAC,EAAS,GAAI,IAAKC,CAAW,EAAIF,EAEnCG,EAAaR,GAAgB,GAAGM,CAAM,GAAGN,CAAG,GAElD,MAAO,CAIH,IAAOA,EAAaC,EAAUQ,EAA+B,CACzD,GAAI,CACA,IAAMC,EAAMD,GAAY,KAAOF,EACzBI,EAAyB,CAC3B,MAAAV,EACA,OAAQS,EAAM,KAAK,IAAI,EAAIA,EAAM,IAAO,MAC5C,EACAN,EAAQ,QAAQI,EAAUR,CAAG,EAAG,KAAK,UAAUW,CAAM,CAAC,CAC1D,OAASC,EAAK,CACV,QAAQ,KAAK,0CAA0CZ,CAAG,IAAKY,CAAG,CACtE,CACJ,EAKA,IAAOZ,EAAuB,CAC1B,GAAI,CACA,IAAMa,EAAMT,EAAQ,QAAQI,EAAUR,CAAG,CAAC,EAC1C,GAAIa,IAAQ,KAAM,OAAO,KAEzB,IAAMF,EAAyB,KAAK,MAAME,CAAG,EAG7C,OAAIF,EAAO,QAAU,KAAK,IAAI,EAAIA,EAAO,QACrC,KAAK,OAAOX,CAAG,EACR,MAGJW,EAAO,KAClB,MAAQ,CACJ,OAAO,IACX,CACJ,EAKA,OAAOX,EAAmB,CACtB,GAAI,CACAI,EAAQ,WAAWI,EAAUR,CAAG,CAAC,CACrC,OAASY,EAAK,CACV,QAAQ,KAAK,6CAA6CZ,CAAG,IAAKY,CAAG,CACzE,CACJ,EAKA,IAAIZ,EAAsB,CACtB,OAAO,KAAK,IAAIA,CAAG,IAAM,IAC7B,EAKA,OAAc,CACV,GAAI,CACIM,GAAU,OAAO,OAAW,KAAe,OAAO,aACrC,OAAO,KAAK,YAAY,EAAE,OAAOQ,GAAKA,EAAE,WAAWR,CAAM,CAAC,EAClE,QAAQQ,GAAK,aAAa,WAAWA,CAAC,CAAC,EAE5CV,EAAQ,MAAM,CAEtB,OAASQ,EAAK,CACV,QAAQ,KAAK,kCAAmCA,CAAG,CACvD,CACJ,EAKA,aAAuB,CACnB,OAAOR,IAAYL,CACvB,CACJ,CACJ,CAGA,IAAMgB,EAAiBxB,EAAc,EAExB,CAAE,IAAKK,EAAS,IAAKH,EAAS,OAAQE,EAAY,IAAAD,EAAK,MAAAJ,CAAM,EAAI,CAC1E,IAAKyB,EAAe,IAAI,KAAKA,CAAc,EAC3C,IAAKA,EAAe,IAAI,KAAKA,CAAc,EAC3C,OAAQA,EAAe,OAAO,KAAKA,CAAc,EACjD,IAAKA,EAAe,IAAI,KAAKA,CAAc,EAC3C,MAAOA,EAAe,MAAM,KAAKA,CAAc,CACnD,EAEOvB,EAAQD","names":["index_exports","__export","clear","createStorage","index_default","getItem","has","removeItem","setItem","__toCommonJS","memoryStore","memoryFallback","key","value","getStorage","testKey","storage","options","prefix","defaultTtl","prefixKey","setOptions","ttl","stored","err","raw","k","defaultStorage"]}