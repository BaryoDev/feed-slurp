function h(s,t,i){if(i==="exponential"){let n=t*Math.pow(2,s-1),u=Math.random()*.3*n;return n+u}return t}var E=(s,t)=>t?t.status>=500:!0;async function O(s,t={}){let{retries:i=3,retryDelay:n=1e3,timeout:u=5e3,backoff:a="fixed",retryOn:l=E,onRequest:c,onResponse:f,onError:p,...m}=t,r=0,R=s.toString(),w=m;for(c&&(w=await c(R,m));;){let b=new AbortController,d=setTimeout(()=>b.abort(),u);try{let e=await fetch(R,{...w,signal:b.signal});if(clearTimeout(d),!e.ok){if(r<i&&l(null,e)){r++;let y=h(r,n,a);await new Promise(o=>setTimeout(o,y));continue}throw new Error(`Request failed with status ${e.status}`)}return f?await f(e):e}catch(e){clearTimeout(d),r++;let o=e.name==="AbortError"?new Error("Request timed out"):e;if(p&&p(o),r<=i&&l(o,null)){let q=h(r,n,a);await new Promise(x=>setTimeout(x,q));continue}throw o}}}var I=O;export{I as default,O as resilientFetch};
//# sourceMappingURL=index.js.map